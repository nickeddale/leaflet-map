/*! maps.app 14-02-2015 */
$(document).ready(function(){function a(a){var b=d(a.feature.properties),c=a.getBounds().getCenter(),e=L.marker(c,{icon:n}).bindLabel(b,{noHide:!0,className:"region-label"});o.addLayer(e)}function b(a){return $(a).hasClass("more-reviews")?h(a):$(a).hasClass("region-hotels")?c():void 0}function c(){return console.log(hotelsDisplayed+" "+k),"all"!==hotelsDisplayed?(console.log("display all hotels"),f("all")):(console.log("display hotels only for "+k),f(k))}function d(a){return a.alt_name?a.alt_name:a.name}function e(){return{fillColor:"#fff",weight:2,opacity:1,color:"white",dashArray:"5",fillOpacity:.1}}function f(a){p&&p.clearLayers(),data={region:a},$.ajax({type:"POST",url:"/maps/hoteldata",data:data,dataType:"json",success:function(b){for(var c=b.length-1;c>=0;c--){var d=L.marker([b[c].latitude,b[c].longitude],{icon:m});d.bindPopup(b[c].id+"-"+b[c].name),p.addLayer(d),hotelsDisplayed=a}}}).done(function(){l.addLayer(p)})}function g(a){return"all"!==a?d(a):a}function h(){var a=$(".all-reviews");return a.is(":visible")?a.slideUp():a.slideDown()}function i(){l.dragging.disable()}function j(){l.dragging.enable()}var k,l=L.map("map",{fullscreenControl:!0}).setView(L.latLng(40.7127,-74.0059),12),m=L.icon({iconUrl:"/inc/img/happy.png",iconSize:[20,20],iconAnchor:[22,94],popupAnchor:[-3,-76]}),n=L.icon({iconUrl:" ",iconSize:[1,1],iconAnchor:[1,1],labelAnchor:[1,1]}),o=L.layerGroup(),p=new L.FeatureGroup,q=L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),r=L.geoJson(statesData,{style:e,onEachFeature:function(b,c){a(c),c.on("mouseover",function(){this.setStyle({fillColor:"#fff",weight:2,opacity:1,color:"white",dashArray:"3",fillOpacity:.5})}),c.on("mouseout",function(){this.setStyle(e())}),c.on("click",function(a){l.getZoom()<=11&&l.fitBounds(a.target.getBounds());var b=g(c.feature.properties);f(b),t.update(c.feature.properties,"click"),this.setStyle(e())})}}),s={"Region Labels":o},t=L.control();t.onAdd=function(){return this._div=L.DomUtil.create("div","info"),L.DomEvent.addListener(this._div,"click",L.DomEvent.stopPropagation).addListener(this._div,"click",function(a){b(a.target)}),this.update(),this._div},t.update=function(a){if(a)var b=d(a);var c='\n		<div class="review-box" id="review-box">\n\n		      <h4>'+b+'</h4>\n		      <form>\n				<small class="region-hotels-description">Show hotels only for this region:</small>\n		      	<input id="command" class="region-hotels cmn-toggle cmn-toggle-round" checked="true" type="checkbox"/>\n		      	<label class="cmn-label" for="command"></label>\n		      	\n		      </form>\n\n		      <hr />\n		      \n		      <p><small>Rated for you</small></p>\n		      <p class="review review-summary text-center">\n					<span class="glyphicon glyphicon-star"></span>\n					<span class="glyphicon glyphicon-star"></span>\n					<span class="glyphicon glyphicon-star"></span>\n					<span class="glyphicon glyphicon-star"></span>\n					<span class="glyphicon glyphicon-star-empty"></span>\n			  </p>\n		      <hr>\n		    <div class="user-specific-reviews">\n\n		      	<p><small>Top ratings for you</small></p>\n\n		        <p class="review">Shopping:\n					<span class="glyphicon pull-right glyphicon-star"></span>\n					<span class="glyphicon pull-right glyphicon-star"></span>\n					<span class="glyphicon pull-right glyphicon-star"></span>\n					<span class="glyphicon pull-right glyphicon-star"></span>\n					<span class="glyphicon pull-right glyphicon-star"></span>\n		        </p>\n		        <p class="review">Clubs:\n					<span class="glyphicon pull-right glyphicon-star-empty"></span>\n					<span class="glyphicon pull-right glyphicon-star"></span>\n					<span class="glyphicon pull-right glyphicon-star"></span>\n					<span class="glyphicon pull-right glyphicon-star"></span>\n					<span class="glyphicon pull-right glyphicon-star"></span>\n		        </p>\n		        <p class="review">Music:\n\n					<span class="glyphicon pull-right glyphicon-star-empty"></span>\n					<span class="glyphicon pull-right glyphicon-star-empty"></span>\n					<span class="glyphicon pull-right glyphicon-star"></span>\n					<span class="glyphicon pull-right glyphicon-star"></span>\n					<span class="glyphicon pull-right glyphicon-star"></span>\n\n		        </p>\n\n		    </div>\n\n			<span class="more-reviews glyphicon glyphicon-option-horizontal"></span>\n\n	        <hr />\n\n	        <div class="all-reviews">\n\n\n				<p class="review">Transportation:\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				</p>\n				<p class="review">Family:\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				</p>\n				<p class="review">Nature:\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				</p>\n				<p class="review">Expense:\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				</p>\n				<p class="review">Culture:\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				  <span class="glyphicon pull-right glyphicon-star"></span>\n				</p>\n\n		    </div>\n\n		    <div class="explore-region text-center">\n		      	<button id="explore-region" class="btn btn-default btn-xs">\n		      		<small>Explore '+b+' <span class="glyphicon glyphicon-share-alt"></span></small></a>\n		      	</button>\n		    </div>\n\n		</div>\n			';return k=b,this._div.innerHTML=a?c:"Click a region to explore"},q.addTo(l),r.addTo(l),L.control.layers(null,s,{position:"bottomleft"}).addTo(l),t.addTo(l),l.on("load",f("all")),document.getElementsByClassName("info")[0].onmouseover=i,document.getElementsByClassName("info")[0].onmouseout=j});